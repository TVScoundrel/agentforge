# ST-02002: Implement Type-Safe SELECT Tool

## Story Information
- **Story ID**: ST-02002
- **Epic**: EP-02 (Type-Safe Query Tools)
- **Branch**: `feat/st-02002-type-safe-select-tool`
- **Estimate**: 5 hours
- **Priority**: P0

## Description

Implements a type-safe SELECT tool using Drizzle ORM's query builder API. This tool provides a structured, LLM-friendly interface for executing SELECT queries with WHERE conditions, ORDER BY, LIMIT, OFFSET, and column selection.

## Implementation Approach

Instead of creating a separate query-builder.ts wrapper, this implementation uses Drizzle's native `sql` template API directly in the tool. This approach:
- Leverages Drizzle's built-in type safety
- Uses `sql.raw()` for static SQL fragments
- Uses `sql.join()` to concatenate SQL parts
- Uses `sql` template literals for safe parameter binding
- Avoids unnecessary abstraction layers

## Features Implemented

### WHERE Conditions
Supports all common comparison operators:
- `eq`, `ne` - Equality/inequality
- `gt`, `lt`, `gte`, `lte` - Numeric comparisons
- `like` - Pattern matching
- `in`, `notIn` - Array membership
- `isNull`, `isNotNull` - NULL checks

Multiple WHERE conditions are combined with AND logic.

### ORDER BY
- Support for multiple ORDER BY clauses
- `asc` and `desc` directions
- Applied in the order specified

### Pagination
- `LIMIT` - Maximum number of rows to return
- `OFFSET` - Number of rows to skip
- Validated as positive/non-negative integers

### Column Selection
- Specify array of column names to select
- Omit for `SELECT *`
- Column names are properly quoted

### Error Handling
- Sanitized error messages to avoid leaking sensitive data
- Graceful handling of non-existent tables
- Clear validation errors for invalid input

## Files Changed

### Created
- `packages/tools/src/data/relational/tools/relational-select.ts` - Tool implementation
- `packages/tools/tests/data/relational/relational-select-tool.test.ts` - Unit tests

### Modified
- `packages/tools/src/data/relational/tools/index.ts` - Export new tool

## Testing

### Schema Validation Tests (8 passed)
- ✅ Valid SELECT query acceptance
- ✅ Columns array validation
- ✅ WHERE conditions validation
- ✅ ORDER BY clauses validation
- ✅ LIMIT and OFFSET validation
- ✅ Invalid vendor rejection
- ✅ Negative limit rejection
- ✅ Negative offset rejection

### Tool Invocation Tests (6 skipped - SQLite bindings not available)
- Simple SELECT query
- Non-existent table handling
- Column selection
- LIMIT application
- OFFSET application
- LIMIT + OFFSET combination

Tests use subqueries to avoid requiring pre-existing database tables, making them more portable.

## Dependencies

- ✅ ST-02001 (Raw SQL Query Execution Tool) - Merged 2026-02-17

## Next Steps

- [ ] Create story documentation
- [ ] Run full test suite
- [ ] Run lint
- [ ] Mark PR ready for review

## Checklist Progress

- [x] Create branch
- [ ] Create draft PR ← **DOING NOW**
- [x] Implement SELECT query builder
- [x] Add WHERE conditions support
- [x] Add ORDER BY support
- [x] Add LIMIT/OFFSET support
- [x] Add column selection support
- [x] Create relational-select tool
- [x] Define Zod schema
- [x] Implement tool function
- [x] Add type-safe result mapping
- [x] Add error handling
- [x] Handle empty result sets
- [x] Export tool
- [x] Create unit tests
- [ ] Create documentation
- [ ] Run test suite
- [ ] Run lint
- [ ] Mark ready for review


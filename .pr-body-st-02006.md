# ST-02006: Implement SQL Sanitization and Security

## Story
- **ID:** ST-02006
- **Epic:** EP-02 (Query Execution and CRUD Operations)
- **Branch:** `feat/st-02006-sql-sanitization-security`

## What Changed
- Added SQL sanitization helpers in `packages/tools/src/data/relational/utils/sql-sanitizer.ts`:
  - `validateSqlString`
  - `enforceParameterizedQueryUsage`
- Added a shared placeholder pattern and reused it in both validation and query execution paths.
- Scoped barrel exports in `packages/tools/src/data/relational/utils/index.ts` to the primary sanitizer entry points.
- Integrated sanitizer enforcement into `packages/tools/src/data/relational/query/query-executor.ts` before query construction and execution.
- Expanded blocked DDL operations to include `CREATE` in agent-exposed query paths.
- Improved dangerous-keyword detection by ignoring SQL comments and string literals during scanning.
- Closed mutation-enforcement bypasses for leading comments and `WITH ... INSERT/UPDATE/DELETE` queries.
- Allowed `"Missing parameters"` validation errors to propagate as safe errors.
- Added security tests in `packages/tools/tests/data/relational/sql-sanitizer.test.ts` and updated related relational query tests.
- Added security documentation:
  - `docs/sql-injection-prevention-best-practices.md`
  - `docs/st02006-sql-sanitization-security.md`

## Acceptance Criteria Coverage
- Input validation for SQL strings implemented.
- Dangerous SQL operation detection implemented for `CREATE`, `DROP`, `TRUNCATE`, `ALTER`.
- Parameterized-query enforcement integrated for mutation statements.
- Placeholder detection is consistent across sanitizer and executor paths.
- Unit tests for sanitizer + injection payload coverage added.
- OWASP-style SQL injection payload checks added.
- Regression coverage added for legitimate keyword usage in comments/string literals/identifiers.
- Regression coverage added for comment/CTE mutation bypass and placeholders inside strings/comments.
- Security best practices and audit checklist documented.

## Validation Performed
- Focused relational security tests:
  - `pnpm exec vitest run packages/tools/tests/data/relational/sql-sanitizer.test.ts packages/tools/tests/data/relational/query-executor.test.ts packages/tools/tests/data/relational/relational-query-tool.test.ts`
  - Result: 30 passed, 21 skipped
- Full test suite:
  - `pnpm test --run`
  - Result: 95 passed, 2 skipped files; 1174 passed, 78 skipped tests
- Lint:
  - `pnpm lint`
  - Result: passed (0 lint errors; warnings-only output) after lint-baseline cleanup merged in PR #32

## Review Scope Note
- Lint baseline cleanup has been merged separately in PR #32.
- This PR remains focused on SQL sanitization and security behavior for relational query paths.

## Status
âœ… Ready for review
